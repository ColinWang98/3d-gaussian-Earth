<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HK 3DGS Tracker | é¦™æ¸¯æ­¥è¸ª</title>
    <style>
        :root { --primary: #00ff88; --processing: #ffcc00; --glass: rgba(10, 15, 30, 0.9); }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', system-ui, sans-serif; color: white; }
        #canvas-container { position: absolute; inset: 0; z-index: 1; }
        #ui-layer { position: absolute; inset: 0; pointer-events: none; z-index: 10; }
        .pointer-auto { pointer-events: auto; }
        
        /* UI Components */
        #upload-btn { position: absolute; top: 20px; right: 20px; background: linear-gradient(135deg, #00c6ff, #0072ff); border: none; padding: 12px 24px; border-radius: 50px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,114,255,0.3); }
        #picker-toast { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(255, 200, 0, 0.95); color: black; font-weight: bold; padding: 10px 25px; border-radius: 30px; display: none; z-index: 100; }
        
        /* Modals */
        #modal-overlay { display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 100; justify-content: center; align-items: center; }
        .modal-box { background: #151525; padding: 25px; border-radius: 16px; width: 90%; max-width: 400px; border: 1px solid #333; pointer-events: auto; }
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85em; color: #888; margin-bottom: 5px; }
        input, textarea { width: 100%; box-sizing: border-box; background: #050510; border: 1px solid #444; color: white; padding: 10px; border-radius: 8px; }
        .btn-submit { width: 100%; background: var(--primary); color: black; border:none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* Info Bar */
        #info-bar { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 480px; background: var(--glass); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); display: none; }
        .action-btn { background: var(--primary); color: #000; border: none; padding: 10px 25px; border-radius: 20px; font-weight: bold; cursor: pointer; float: right; margin-top: -30px; }
        #splat-viewer { position: absolute; inset: 0; background: #000; z-index: 50; display: none; }
    </style>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/",
            "geo-three": "https://cdn.jsdelivr.net/npm/geo-three@0.0.11/build/geo-three.module.js",
            "@mkkellogg/gaussian-splats-3d": "https://cdn.jsdelivr.net/npm/@mkkellogg/gaussian-splats-3d@0.4.6/build/gaussian-splats-3d.module.js",
            "@huggingface/hub": "https://cdn.jsdelivr.net/npm/@huggingface/hub@0.15.1/+esm"
        }
    }
    </script>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="picker-toast">ğŸ“ è¯·ç›´æ¥ç‚¹å‡»åœ°å›¾ä¸Šçš„ä½ç½®...</div>
    <div id="splat-viewer" class="pointer-auto"><button id="close-splat" style="position:absolute;top:20px;left:20px;z-index:60;padding:10px;cursor:pointer;">â† è¿”å›åœ°å›¾</button></div>

    <div id="ui-layer">
        <button id="upload-btn" class="pointer-auto" onclick="UI.openUpload()">+ æ–°å¢ 3D é‡å»ºä»»åŠ¡</button>
        <div id="info-bar" class="pointer-auto">
            <h3 id="loc-title" style="margin:0">é¦™æ¸¯åœ°ç‚¹</h3>
            <p id="loc-status" style="color:var(--processing); font-size:0.85em; margin:5px 0;"></p>
            <p id="loc-desc" style="color:#aaa; font-size:0.9em;"></p>
            <button id="enter-btn" class="action-btn" onclick="App.enterSplatMode()">è¿›å…¥åœºæ™¯</button>
        </div>

        <div id="modal-overlay" class="pointer-auto">
            <div class="modal-box">
                <h3 style="margin-top:0">é…ç½® GPU å¤„ç†ä»»åŠ¡</h3>
                <div class="input-group"><label>HF Write Token</label><input type="password" id="hf-token" placeholder="hf_..."></div>
                <div class="input-group">
                    <label>åœ°ç†ä½ç½®</label>
                    <div style="display:flex; gap:8px;">
                        <input type="text" id="lat-lon-display" readonly placeholder="ç‚¹å‡»å³ä¾§æŒ‰é’®åœ¨åœ°å›¾ç‚¹é€‰" style="flex:1; background:#111;">
                        <button onclick="App.startPickerMode()" style="background:#0072ff; color:white; border:none; border-radius:8px; padding:0 15px; cursor:pointer; font-weight:bold;">ğŸ“ æ‹¾å–ä½ç½®</button>
                    </div>
                </div>
                <div class="input-group"><label>è¾“å…¥å›¾ç‰‡ (.jpg/.png)</label><input type="file" id="photo" accept="image
